# System Monitoring Script

## ÐžÐ¿Ð¸ÑÐ°Ð½Ð¸Ðµ
Ð­Ñ‚Ð¾Ñ‚ bash-ÑÐºÑ€Ð¸Ð¿Ñ‚ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÑÐµÑ‚ ÐºÐ¾Ð¼Ð¿Ð»ÐµÐºÑÐ½Ñ‹Ð¹ Ð¼Ð¾Ð½Ð¸Ñ‚Ð¾Ñ€Ð¸Ð½Ð³ ÑÐ¸ÑÑ‚ÐµÐ¼Ñ‹, Ð²ÐºÐ»ÑŽÑ‡Ð°Ñ:
* Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÑƒ CPU
* Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð´Ð¸ÑÐºÐ¾Ð²Ð¾Ð³Ð¾ Ð¿Ñ€Ð¾ÑÑ‚Ñ€Ð°Ð½ÑÑ‚Ð²Ð°
* Ð¡Ð¾ÑÑ‚Ð¾ÑÐ½Ð¸Ðµ ÑÐµÑ‚Ð¸ Ð¸ Ð°ÐºÑ‚Ð¸Ð²Ð½Ñ‹Ðµ ÑÐ¾ÐµÐ´Ð¸Ð½ÐµÐ½Ð¸Ñ
* Ð¡ÐµÑ‚ÐµÐ²Ñ‹Ðµ Ð¸Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹ÑÑ‹ Ð¸ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñƒ Ð¼Ð°Ñ€ÑˆÑ€ÑƒÑ‚Ð¸Ð·Ð°Ñ†Ð¸Ð¸

**Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ñ‹ ÑÐ¾Ñ…Ñ€Ð°Ð½ÑÑŽÑ‚ÑÑ Ð² Ð»Ð¾Ð³-Ñ„Ð°Ð¹Ð» Ñ Ð´Ð°Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ð¼ Ð¸Ð¼ÐµÐ½ÐµÐ¼ Ð² `/var/log/monitoring/` Ð² Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚Ðµ (system_monitoring_YYYYMMDD.log).**
**Ð›Ð¾Ð³-Ñ„Ð°Ð¹Ð»Ñ‹ ÑÑ‚Ð°Ñ€ÑˆÐµ 10 Ð´Ð½ÐµÐ¹ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ ÑƒÐ´Ð°Ð»ÑÑŽÑ‚ÑÑ.**


## Ð§Ñ‚Ð¾ Ð¼Ð¾Ð½Ð¸Ñ‚Ð¾Ñ€Ð¸Ñ‚ ÑÐºÑ€Ð¸Ð¿Ñ‚ (Ð¿Ð¾Ð´Ñ€Ð¾Ð±Ð½ÐµÐµ)
1. ÐŸÑ€Ð¾Ñ†ÐµÑÑÐ¾Ñ€ (CPU)
* ÐžÐ±Ñ‰ÑƒÑŽ Ð½Ð°Ð³Ñ€ÑƒÐ·ÐºÑƒ (user space)
* Ð”ÐµÑ‚Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸ÑŽ Ð¿Ñ€Ð¸ Ð½Ð°Ð³Ñ€ÑƒÐ·ÐºÐµ > 50%

2. Ð”Ð¸ÑÐºÐ¾Ð²Ð¾Ðµ Ð¿Ñ€Ð¾ÑÑ‚Ñ€Ð°Ð½ÑÑ‚Ð²Ð¾
* Ð’ÑÐµ Ñ€Ð°Ð·Ð´ÐµÐ»Ñ‹ Ñ Ð·Ð°Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸ÐµÐ¼ > 20%
* Ð¤Ð¾Ñ€Ð¼Ð°Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ð¹ Ð²Ñ‹Ð²Ð¾Ð´ Ñ Ð·Ð°Ð³Ð¾Ð»Ð¾Ð²ÐºÐ°Ð¼Ð¸

3. Ð¡ÐµÑ‚ÑŒ
* Ð”Ð¾ÑÑ‚ÑƒÐ¿Ð½Ð¾ÑÑ‚ÑŒ Google (ping)
* ÐžÑ‚ÐºÑ€Ñ‹Ñ‚Ñ‹Ðµ Ð¿Ð¾Ñ€Ñ‚Ñ‹ (LISTEN)
* ÐÐºÑ‚Ð¸Ð²Ð½Ñ‹Ðµ ÑÐ¾ÐµÐ´Ð¸Ð½ÐµÐ½Ð¸Ñ (ESTABLISHED)
* ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸ Ð¸Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹ÑÐ¾Ð² (ÐºÑ€Ð°Ñ‚ÐºÐ¸Ð¹ Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚)
* Ð¢Ð°Ð±Ð»Ð¸Ñ†Ñƒ Ð¼Ð°Ñ€ÑˆÑ€ÑƒÑ‚Ð¸Ð·Ð°Ñ†Ð¸Ð¸


## ÐžÑÐ¾Ð±ÐµÐ½Ð½Ð¾ÑÑ‚Ð¸ Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹
* Ð”Ð»Ñ ÑÐµÑ‚ÐµÐ²Ñ‹Ñ… Ð¿Ñ€Ð¾Ð²ÐµÑ€Ð¾Ðº Ñ‚Ñ€ÐµÐ±ÑƒÑŽÑ‚ÑÑ Ð¿Ñ€Ð°Ð²Ð° root
* ÐŸÑ€Ð¸ Ð²Ñ‹ÑÐ¾ÐºÐ¾Ð¹ Ð½Ð°Ð³Ñ€ÑƒÐ·ÐºÐµ CPU (>50%) Ð²Ñ‹Ð²Ð¾Ð´Ð¸Ñ‚ Ð´ÐµÑ‚Ð°Ð»ÑŒÐ½ÑƒÑŽ Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸ÑŽ
* ÐŸÑ€Ð¸ Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼Ð°Ñ… Ñ ping Ð¿Ð¾ÐºÐ°Ð·Ñ‹Ð²Ð°ÐµÑ‚ Ð¿Ð¾Ð´Ñ€Ð¾Ð±Ð½Ñ‹Ð¹ Ð²Ñ‹Ð²Ð¾Ð´


## Ð—Ð°Ð¿ÑƒÑÐº
* ÐŸÐµÑ€ÐµÐ¹Ð´Ð¸Ñ‚Ðµ Ð² Ð¿Ð°Ð¿ÐºÑƒ ÑÐ¾ ÑÐºÑ€Ð¸Ð¿Ñ‚Ð¾Ð¼ Ð¸ Ð·Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚Ðµ c Ð¿Ñ€Ð°Ð²Ð°Ð¼Ð¸ root
```
cd /Ð¿ÑƒÑ‚ÑŒ Ð´Ð¾ Ñ„Ð°Ð¹Ð»Ð°/monitoring_system
sudo ./monitoring_system_script.sh
```
* ÐŸÑ€Ð¸ Ð½ÐµÐ¾Ð±Ñ…Ð¾Ð´Ð¸Ð¼Ð¾ÑÑ‚Ð¸, Ð´Ð°Ð¹Ñ‚Ðµ Ð¿Ñ€Ð°Ð²Ð° Ð½Ð° Ð·Ð°Ð¿ÑƒÑÐº
```
sudo chmod +x /Ð¿ÑƒÑ‚ÑŒ Ð´Ð¾ Ñ„Ð°Ð¹Ð»Ð°/monitoring_system/monitoring_system_script.sh
```


## ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹ Ð·Ð°Ð¿ÑƒÑÐº
Ð•ÑÐ»Ð¸ Ð²Ñ‹ Ñ…Ð¾Ñ‚Ð¸Ñ‚Ðµ, Ñ‡Ñ‚Ð¾Ð±Ñ‹ ÑÐºÑ€Ð¸Ð¿Ñ‚ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ Ð·Ð°Ð¿ÑƒÑÐºÐ°Ð»ÑÑ ÐµÐ¶ÐµÐ´Ð½ÐµÐ²Ð½Ð¾ Ð² Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð½Ð¾Ðµ Ð²Ñ€ÐµÐ¼Ñ, Ñ‚Ð¾ Ð¼Ð¾Ð¶Ð½Ð¾ Ð²Ð¾ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÑŒÑÑ **`cron`**.
* ÐžÑ‚ÐºÑ€Ð¾Ð¹Ñ‚Ðµ 'crontab' Ð´Ð»Ñ Ñ€ÐµÐ´Ð°ÐºÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ
  ```
  sudo crontab -e
  ```
* ÐŸÑ€Ð¸ Ð¿ÐµÑ€Ð²Ð¾Ð¼ Ð·Ð°Ð¿ÑƒÑÐºÐµ, Ð¾Ð½ ÑÐ¿Ñ€Ð¾ÑÐ¸Ñ‚ Ð² ÐºÐ°ÐºÐ¾Ð¼ Ñ€ÐµÐ´Ð°ÐºÑ‚Ð¾Ñ€Ðµ Ð²Ñ‹ Ñ…Ð¾Ñ‚Ð¸Ñ‚Ðµ Ð¾Ñ‚ÐºÑ€Ñ‹Ð²Ð°Ñ‚ÑŒ Ñ„Ð°Ð¹Ð». Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ñ†Ð¸Ñ„Ñ€Ñƒ Ð¾Ñ‚ 1 Ð´Ð¾ 4.
* Ð”Ð¾Ð±Ð°Ð²ÑŒÑ‚Ðµ ÑÑ‚Ñ€Ð¾Ñ‡ÐºÑƒ, ÐºÐ¾Ñ‚Ð¾Ñ€Ð°Ñ Ð¾Ð·Ð½Ð°Ñ‡Ð°ÐµÑ‚, Ñ‡Ñ‚Ð¾ ÑÐºÑ€Ð¸Ð¿Ñ‚ Ð±ÑƒÐ´ÐµÑ‚ Ð·Ð°Ð¿ÑƒÑÐºÐ°Ñ‚ÑŒÑÑ ÐµÐ¶ÐµÐ´Ð¶Ð½ÐµÐ²Ð½Ð¾ Ð² 12:00
  ```
  0 12 * * * /usr/local/bin/system_monitor.sh
  ```
* Ð¡Ð¾Ñ…Ñ€Ð°Ð½Ð¸Ñ‚Ðµ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ Ð¸ Ð²Ñ‹Ð¹Ð´Ð¸Ñ‚Ðµ Ð¸Ð· Ñ„Ð°Ð¹Ð»Ð°.
* Ð”Ð»Ñ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ¸ Ñ‚ÐµÐºÑƒÑ‰Ð¸Ñ… Ð·Ð°Ð´Ð°Ñ‡ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ
  ```
  sudo crontab -l
  ```
* Ð”Ð»Ñ ÑƒÐ´Ð°Ð»ÐµÐ½Ð¸Ñ
  ```
  sudo crontab -r
  ```

## ÐžÑ‚ÐºÑ€Ñ‹Ñ‚ÑŒ Ð»Ð¾Ð³-Ñ„Ð°Ð¹Ð»
```
sudo nano /var/log/monitoring/system_monitoring_*.log
```
Ð³Ð´Ðµ Ð·Ð²ÐµÐ·Ð´Ð¾Ñ‡ÐºÐ°, ÑÑ‚Ð¾ Ð´Ð°Ñ‚Ð° Ð·Ð°Ð¿Ð¸ÑÐ¸ Ð»Ð¾Ð³Ð° Ð² Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚Ðµ YYYYMMDD, Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€, 20250711

## ÐŸÑ€Ð¸Ð¼ÐµÑ€ Ð»Ð¾Ð³-Ñ„Ð°Ð¹Ð»Ð°
```
======== Wed Jan 15 12:00:01 MSK 2025 ========

ðŸ”¹ CPU Load (filtered > 50%):
CPU load is normal, 15%

ðŸ”¹ Disk Usage (filtered > 20%):
Filesystem      Size  Used Avail Use% Mounted on
/dev/sda1        50G   30G   20G  60% /

ðŸ”¹ Network Check (ping google.com):
Ping: OK (0% packet loss)

ðŸ”¹ Listening Ports:
tcp         0.0.0.0:22         LISTEN
tcp         0.0.0.0:80         LISTEN

====================== END ======================
```

