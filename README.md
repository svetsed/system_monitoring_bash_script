# System Monitoring Script

## Описание
Этот bash-скрипт выполняет комплексный мониторинг системы, включая:
* Загрузку CPU
* Использование дискового пространства
* Состояние сети и активные соединения
* Сетевые интерфейсы и таблицу маршрутизации

**Результаты сохраняются в лог-файл с датированным именем в `/var/log/monitoring/` в формате (system_monitoring_YYYYMMDD.log).**
**Лог-файлы старше 10 дней автоматически удаляются.**


## Что мониторит скрипт (подробнее)
1. Процессор (CPU)
* Общую нагрузку (user space)
* Детализацию при нагрузке > 50%

2. Дисковое пространство
* Все разделы с заполнением > 20%
* Форматированный вывод с заголовками

3. Сеть
* Доступность Google (ping)
* Открытые порты (LISTEN)
* Активные соединения (ESTABLISHED)
* Настройки интерфейсов (краткий формат)
* Таблицу маршрутизации


## Особенности работы
* Для сетевых проверок требуются права root
* При высокой нагрузке CPU (>50%) выводит детальную информацию
* При проблемах с ping показывает подробный вывод


## Запуск
* Перейдите в папку со скриптом и запустите c правами root
```
cd /путь до файла/monitoring_system
sudo ./monitoring_system_script.sh
```
* При необходимости, дайте права на запуск
```
sudo chmod +x /путь до файла/monitoring_system/monitoring_system_script.sh
```


## Автоматический запуск
Если вы хотите, чтобы скрипт автоматически запускался ежедневно в определенное время, то можно воспользоваться **`cron`**.
* Откройте 'crontab' для редактирования
  ```
  sudo crontab -e
  ```
* При первом запуске, он спросит в каком редакторе вы хотите открывать файл. Выберите цифру от 1 до 4.
* Добавьте строчку, которая означает, что скрипт будет запускаться ежеджневно в 12:00
  ```
  0 12 * * * /usr/local/bin/system_monitor.sh
  ```
* Сохраните изменения и выйдите из файла.
* Для проверки текущих задач используйте
  ```
  sudo crontab -l
  ```
* Для удаления
  ```
  sudo crontab -r
  ```

## Открыть лог-файл
```
sudo nano /var/log/monitoring/system_monitoring_*.log
```
где звездочка, это дата записи лога в формате YYYYMMDD, например, 20250711

## Пример лог-файла
```
======== Wed Jan 15 12:00:01 MSK 2025 ========

🔹 CPU Load (filtered > 50%):
CPU load is normal, 15%

🔹 Disk Usage (filtered > 20%):
Filesystem      Size  Used Avail Use% Mounted on
/dev/sda1        50G   30G   20G  60% /

🔹 Network Check (ping google.com):
Ping: OK (0% packet loss)

🔹 Listening Ports:
tcp         0.0.0.0:22         LISTEN
tcp         0.0.0.0:80         LISTEN

====================== END ======================
```

